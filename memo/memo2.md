# 守備範囲

memo0.mdのうち、一部の機能を実装したミニマムなアプリを作る。

## 目的

掌編小説をMarkdownでサクっと書く。

* リアルタイムプレビューしたい
	* CSS無し
* 保存したい
	* どこに？
		* ローカル
			* どうやって？
				* ファイルシステム
					* window.Blob
					* File API
				* ブラウザ
					* LocalStorage
					* IndexedDatabas
		* GitHub
			* 任意ユーザ
				* 任意リポジトリ（デフォルト値は`Novel.yyyyMMddHHmmss`。リポジトリ作成日時）
	* なにを
		* Markdown形式
		* HTML形式

ただし、ファイルをまとめる機能は実装が大変なので対象外とする。

### 目標

* 小説
	* h1, p, rubyのタグのみ使用
* 掌編
	* 1ファイル完結
		* ファイル間リンクしない
		* ファイル名:
			* `yyyyMMddHHmmss.md`
				* ファイル名にタイトルは含めない
					* 日本語が使われるだろうから
						* 文字コード問題が起こるから
							* GitHub
							* OS、ファイルシステム、ターミナル
	* 字数
		* 1〜1600字
		* 字数リアルタイムカウンタ
			* 1600字以上で入力できなくなる（エラー通知）
	* 文書構造
		* h1が1つとpのみ。

#### 目標外

##### GitHub

編集、削除はおろか、リポジトリ作成するだけでも実装が難しくなる。全面的に対象外。

##### 配置

ローカル保存すると、ユーザが再配置せねばならない。

ローカル保存はブラウザのダウンロードパスとなる。しかし、保存した小説は違うパスに保存したいだろう。普通はファイラを使い、自分でディレクトリ管理して保存する。それが自動化できないので二度手間になる。

File API なら解決できるかもしれないが、実装が難しくなるため対象外。

##### 検索

ファイルを複数作成すると次のような問題が生まれる。

* 書いた小説を探せない
	* あのファイルどこいった？
		* ファイル配置は任意。ツールで管理していない
			* ファイラを使って手動で配置せねばならない
		* ファイル名から内容がわからない
			* ファイル名にタイトルが付いていない

以下のような対策で解決できるだろうが、実装が大変なので対象外とする。

* サマリーページ
	* サマリー
		* 小説数: 
		* 字数:
		* 日時: 最終、最初 
	* 小説リスト 
		* テーブル
			* タイトル
			* 字数（100,200,400,800,1600,1〜1600）
			* 作成日時
			* 最終更新日時
* リポジトリ
	* 編集(修正)、削除
	* 1つのみ使用（上限1GB）
		* リポジトリ名の指定

よって、単一ファイルのみを保存対象とする。必然的に掌編のような小規模小説に適したツールとなる。

## 最低機能

* [Ace](https://ace.c9.io/)によるテキストエディタ
* [Markdown-it](https://markdown-it.github.io/)によるHTMLパース
* HTMLビューア
* ルビ記法（[でんでんマークダウン](https://conv.denshochan.com/markdown#ruby)）

# 実装フェーズ

1. ローカル保存
1. Githubアップロード
1. Github編集
1. Github削除

## 1. ローカル保存

1-1. Markdownファイルをローカルに保存する
1-2. HTMLファイルをローカルに保存する

## 2. Githubアップロード













* ルビ振り
* 傍点（圏点）
* 縦書き

* 字数カウント

* CSS動的設定
* CSSジェネレータ

* 保存
* アップロード

* プロジェクト
	* ディレクトリ（複数ファイル）
	* リポジトリ
	* テンプレート
		* 日記
		* 戯曲
			* 掲示板風
			* チャット風
			* LINE風
			* 一言ひとりごと
		* 小説
			* １ファイル完結
			* リスト構造
				* 多ファイル連載
		* 実用書
			* ツリー構造
				* 手順書
				* 作業履歴
	* 関連付け
		* 誰の関連付けか
			* 作者
			* 各読者
			* 共有
		* 関連
			* 著者
			* 公開日時
			* 最終更新日時
			* カテゴライズ
			* タギング
			* 属性
				* 関連作品
					* 続編、外伝、スピンオフ
* ファイルジェネレータ
	* 固定HTML（MarkdownからHTMLファイルを出力）
	* 動的ロード（外部Markdownをロードし動的にHTML化）



# 優先順位

項目|理由
----|----
ルビ|字が読めないストレス大
保存|ファイルでローカル保存しないとエディタの意味ない
字数カウント|物書きの練習。指標
傍点|簡単
縦書き|CSSだけでなくHTMLも変わるため実装苦労
CSS動的設定|縦書きも含めるため縦書きより低優先
CSSジェネレータ|読者より作者側ツールのため低優先
アップロード|github, gitbookにアップロード（バックアップ、ファイル公開、HTML公開）

# 要件詳細

## ルビ振り

```
漢(かん)字(じ)
```
```html
<ruby>漢<rt>かん</rt>字<rt>じ</rt></ruby>
```

これを簡単に記述できて読みやすい書式にしたい。既存のローカル書式が多数あるが、でんでんマークダウンを採用したい。

* 統一されており覚えやすい
* 字数が少なく見やすい

### でんでん https://conv.denshochan.com/markdown#ruby

```
{漢字|かんじ}→<ruby>漢字<rt>かんじ</rt></ruby>
{漢字|かん|じ}→<ruby>漢<rt>かん</rt>字<rt>じ</rt></ruby>
※傍点(圏点)書式はない。{漢字}とすると傍点としたい。html5,css3でいうtext-emphasis。
{漢字}→<strong style="text-emphasis: filled circle;">漢字</strong>
```

### 小説家になろう https://syosetu.com/man/ruby/

```
|山田太郎《やまだたろう》
山田太郎(やまだたろう)		前:漢字, 後:ひらがな/カタカナ の場合のみ
山田太郎｜(やまだたろう)		ルビ回避
|山田《やまだ》|太郎《たろう》
```

### 青空文庫 http://www.aozora.gr.jp/KOSAKU/MANUAL_2.html

```
|山田太郎《やまだたろう》
山田太郎《やまだたろう》		前:漢字, 後:ひらがな/カタカナ の場合のみ
```

### カクヨム https://kakuyomu.jp/help/entry/notation

```
(青空文庫と同様)　《《圏点》》　が使える。
```

### ピクシブ https://www.pixiv.net/info.php?id=3065

```
[[rb:pixiv > ピクシブ]]
```


## 傍点（圏点）


```
・・
強調したい。
```
```html
<strong style="text-emphasis: filled circle;">強調</strong>したい。
```

でんでんマークダウンには無かったが、以下の書式にしたい。

```
{強調}したい。
```

## 縦書き

縦書きは考慮すべきことが多数ある。横書きとは別のHTMLになる。

* 縦中横
* 英字回転

### 縦中横

```html
<span class="tcy">1945</span>年
```

数字を横書きにする。

### 英字回転

```html
<span class="alphabet-vartical">1945</span>年
```

左に90度回転して縦書きにする。

全体を縦書きにする`writing-mode: vertical-rl;`では英字を回転できないため、個別に対応する。

